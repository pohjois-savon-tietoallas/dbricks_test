<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Text mining with sparklyr | _main.utf8</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Text mining with sparklyr | _main.utf8" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Text mining with sparklyr | _main.utf8" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="databricks-connect.html"/>
<link rel="next" href="intro-to-sparklyr.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="databricks-connect.html"><a href="databricks-connect.html"><i class="fa fa-check"></i><b>1</b> Databricks Connect</a><ul>
<li class="chapter" data-level="1.1" data-path="databricks-connect.html"><a href="databricks-connect.html#background"><i class="fa fa-check"></i><b>1.1</b> Background</a></li>
<li class="chapter" data-level="1.2" data-path="databricks-connect.html"><a href="databricks-connect.html#cluster-setup"><i class="fa fa-check"></i><b>1.2</b> Cluster setup</a></li>
<li class="chapter" data-level="1.3" data-path="databricks-connect.html"><a href="databricks-connect.html#client-setup"><i class="fa fa-check"></i><b>1.3</b> Client setup</a><ul>
<li class="chapter" data-level="1.3.1" data-path="databricks-connect.html"><a href="databricks-connect.html#install-java"><i class="fa fa-check"></i><b>1.3.1</b> Install Java</a></li>
<li class="chapter" data-level="1.3.2" data-path="databricks-connect.html"><a href="databricks-connect.html#install-python"><i class="fa fa-check"></i><b>1.3.2</b> Install Python</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="databricks-connect.html"><a href="databricks-connect.html#get-connection-values"><i class="fa fa-check"></i><b>1.4</b> Get connection values</a></li>
<li class="chapter" data-level="1.5" data-path="databricks-connect.html"><a href="databricks-connect.html#configure-connection-settings"><i class="fa fa-check"></i><b>1.5</b> Configure connection settings</a></li>
<li class="chapter" data-level="1.6" data-path="databricks-connect.html"><a href="databricks-connect.html#setting-up-rstudio"><i class="fa fa-check"></i><b>1.6</b> Setting up RStudio</a></li>
<li class="chapter" data-level="1.7" data-path="databricks-connect.html"><a href="databricks-connect.html#troubleshoot"><i class="fa fa-check"></i><b>1.7</b> Troubleshoot</a><ul>
<li class="chapter" data-level="1.7.1" data-path="databricks-connect.html"><a href="databricks-connect.html#mac-error-starting-a-spark-session"><i class="fa fa-check"></i><b>1.7.1</b> Mac: Error starting a spark session</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html"><i class="fa fa-check"></i><b>2</b> Text mining with <code>sparklyr</code></a><ul>
<li class="chapter" data-level="2.1" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#data-importg"><i class="fa fa-check"></i><b>2.1</b> Data Importg</a></li>
<li class="chapter" data-level="2.2" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#tidying-data"><i class="fa fa-check"></i><b>2.2</b> Tidying data</a></li>
<li class="chapter" data-level="2.3" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#transform-the-data"><i class="fa fa-check"></i><b>2.3</b> Transform the data</a></li>
<li class="chapter" data-level="2.4" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#data-exploration"><i class="fa fa-check"></i><b>2.4</b> Data Exploration</a></li>
<li class="chapter" data-level="2.5" data-path="text-mining-with-sparklyr.html"><a href="text-mining-with-sparklyr.html#appendix"><i class="fa fa-check"></i><b>2.5</b> Appendix</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html"><i class="fa fa-check"></i><b>3</b> Intro to <code>sparklyr</code></a><ul>
<li class="chapter" data-level="3.1" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#new-spark-session"><i class="fa fa-check"></i><b>3.1</b> New Spark session</a></li>
<li class="chapter" data-level="3.2" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#data-transfer"><i class="fa fa-check"></i><b>3.2</b> Data transfer</a></li>
<li class="chapter" data-level="3.3" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#spark-and-dplyr"><i class="fa fa-check"></i><b>3.3</b> Spark and <code>dplyr</code></a></li>
<li class="chapter" data-level="3.4" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#feature-transformers"><i class="fa fa-check"></i><b>3.4</b> Feature transformers</a></li>
<li class="chapter" data-level="3.5" data-path="intro-to-sparklyr.html"><a href="intro-to-sparklyr.html#models"><i class="fa fa-check"></i><b>3.5</b> Models</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="testing-databricks-connect-on-desktop-rstudio-.html"><a href="testing-databricks-connect-on-desktop-rstudio-.html"><i class="fa fa-check"></i><b>4</b> Testing databricks connect on desktop RStudio.</a><ul>
<li class="chapter" data-level="4.1" data-path="testing-databricks-connect-on-desktop-rstudio-.html"><a href="testing-databricks-connect-on-desktop-rstudio-.html#connect-to-databricks"><i class="fa fa-check"></i><b>4.1</b> Connect to databricks</a></li>
<li class="chapter" data-level="4.2" data-path="testing-databricks-connect-on-desktop-rstudio-.html"><a href="testing-databricks-connect-on-desktop-rstudio-.html#test"><i class="fa fa-check"></i><b>4.2</b> Test</a></li>
<li class="chapter" data-level="4.3" data-path="testing-databricks-connect-on-desktop-rstudio-.html"><a href="testing-databricks-connect-on-desktop-rstudio-.html#datasets"><i class="fa fa-check"></i><b>4.3</b> Datasets</a></li>
<li class="chapter" data-level="4.4" data-path="testing-databricks-connect-on-desktop-rstudio-.html"><a href="testing-databricks-connect-on-desktop-rstudio-.html#stop"><i class="fa fa-check"></i><b>4.4</b> Stop</a></li>
<li class="chapter" data-level="4.5" data-path="testing-databricks-connect-on-desktop-rstudio-.html"><a href="testing-databricks-connect-on-desktop-rstudio-.html#notes"><i class="fa fa-check"></i><b>4.5</b> Notes</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="text-mining-with-sparklyr" class="section level1">
<h1><span class="header-section-number">2</span> Text mining with <code>sparklyr</code></h1>
<p>For this example, there are two files that will be analyzed. They are both the full works of Sir Arthur Conan Doyle and Mark Twain. The files were downloaded from the <a href="https://www.gutenberg.org/">Gutenberg Project</a> site via the <code>gutenbergr</code> package. Intentionally, no data cleanup was done to the files prior to this analysis. See the appendix below to see how the data was downloaded and prepared.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">readLines</span>(<span class="st">&quot;./data/arthur_doyle.txt&quot;</span>, <span class="dv">30</span>)</a></code></pre></div>
<div id="data-importg" class="section level2">
<h2><span class="header-section-number">2.1</span> Data Importg</h2>
<p><em>Read the book data into Spark</em></p>
<ol start="0" style="list-style-type: decimal">
<li><p>Moving data files to dbfs</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># fs::file_copy(&quot;./data/arthur_doyle.txt&quot;, &quot;/dbfs/arthur_doyle.txt&quot;)</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="co"># fs::file_copy(&quot;./data/mark_twain.txt&quot;, &quot;/dbfs/mark_twain.txt&quot;, overwrite = T)</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="kw">system</span>(<span class="st">&quot;cp ./data/arthur_doyle.txt /dbfs/arthur_doyle.txt&quot;</span>)</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="kw">system</span>(<span class="st">&quot;cp ./data/mark_twain.txt /dbfs/mark_twain.txt&quot;</span>)</a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="kw">list.files</span>(<span class="st">&quot;/dbfs/&quot;</span>)</a></code></pre></div></li>
<li><p>Load <code>SparkR</code> and open new session</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">library</span>(SparkR)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw">sparkR.session</span>()</a></code></pre></div></li>
<li><p>Load the <code>sparklyr</code> library and open a Spark session</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">library</span>(sparklyr)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">sc &lt;-<span class="st"> </span><span class="kw">spark_connect</span>(<span class="dt">method =</span> <span class="st">&quot;databricks&quot;</span>)</a></code></pre></div></li>
<li><p>Use the <code>spark_read_text()</code> function to read the <strong>mark_twain.txt</strong> file, assign it to a variable called <code>twain</code></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">twain &lt;-<span class="st"> </span><span class="kw">spark_read_text</span>(sc, <span class="st">&quot;twain&quot;</span>, <span class="st">&quot;mark_twain.txt&quot;</span>) </a></code></pre></div></li>
<li><p>Use the <code>spark_read_text()</code> function to read the <strong>arthur_doyle.txt</strong> file, assign it to a variable called <code>doyle</code></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">doyle &lt;-<span class="st"> </span><span class="kw">spark_read_text</span>(sc, <span class="st">&quot;doyle&quot;</span>, <span class="st">&quot;arthur_doyle.txt&quot;</span>) </a></code></pre></div></li>
</ol>
</div>
<div id="tidying-data" class="section level2">
<h2><span class="header-section-number">2.2</span> Tidying data</h2>
<p><em>Prepare the data for analysis</em></p>
<ol style="list-style-type: decimal">
<li><p>Load the <code>dplyr</code> library</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a></code></pre></div></li>
<li><p>Add a column to <code>twain</code> named <code>author</code> with a value of “twain”. Assign it to a new variable called <code>twain_id</code></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">twain_id &lt;-<span class="st"> </span>twain <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">author =</span> <span class="st">&quot;twain&quot;</span>)</a></code></pre></div></li>
<li><p>Add a column to <code>doyle</code> named <code>author</code> with a value of “doyle”. Assign it to a new variable called <code>doyle_id</code></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">doyle_id &lt;-<span class="st"> </span>doyle <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">author =</span> <span class="st">&quot;doyle&quot;</span>)</a></code></pre></div></li>
<li><p>Use <code>sdf_bind_rows()</code> to append the two files together in a variable called <code>both</code></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">both &lt;-<span class="st"> </span>doyle_id <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="st">  </span><span class="kw">sdf_bind_rows</span>(twain_id) </a></code></pre></div></li>
<li><p>Preview <code>both</code></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">both</a></code></pre></div></li>
<li><p>Filter out empty lines into a variable called <code>all_lines</code></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">all_lines &lt;-<span class="st"> </span>both <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">nchar</span>(line) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a></code></pre></div></li>
<li><p>Use Hive’s <em>regexp_replace</em> to remove punctuation, assign it to the same <code>all_lines</code> variable</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">all_lines &lt;-<span class="st"> </span>all_lines <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">line =</span> <span class="kw">regexp_replace</span>(line, <span class="st">&quot;[_</span><span class="ch">\&quot;\&#39;</span><span class="st">():;,.!?</span><span class="ch">\\</span><span class="st">-]&quot;</span>, <span class="st">&quot; &quot;</span>))</a></code></pre></div></li>
</ol>
</div>
<div id="transform-the-data" class="section level2">
<h2><span class="header-section-number">2.3</span> Transform the data</h2>
<p><em>Use feature transformers to make additional preparations</em></p>
<ol style="list-style-type: decimal">
<li><p>Use <code>ft_tokenizer()</code> to separate each word. in the line. Set the <code>output_col</code> to “word_list”. Assign to a variable called <code>word_list</code></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">word_list &lt;-<span class="st"> </span>all_lines <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw">ft_tokenizer</span>(</a>
<a class="sourceLine" id="cb30-3" data-line-number="3">  <span class="dt">input_col =</span> <span class="st">&quot;line&quot;</span>,</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">  <span class="dt">output_col =</span> <span class="st">&quot;word_list&quot;</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5">  )</a></code></pre></div></li>
<li><p>Remove “stop words” with the <code>ft_stop_words_remover()</code> transformer. Set the <code>output_col</code> to “wo_stop_words”. Assign to a variable called <code>wo_stop</code></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">wo_stop &lt;-<span class="st"> </span>word_list <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="st">  </span><span class="kw">ft_stop_words_remover</span>(</a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="dt">input_col =</span> <span class="st">&quot;word_list&quot;</span>,</a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="dt">output_col =</span> <span class="st">&quot;wo_stop_words&quot;</span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5">)</a></code></pre></div></li>
<li><p>Un-nest the tokens inside <em>wo_stop_words</em> using <code>explode()</code>. Assign to a variable called <code>exploded</code></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">exploded &lt;-<span class="st"> </span>wo_stop <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">explode</span>(wo_stop_words))</a></code></pre></div></li>
<li><p>Select the <em>word</em> and <em>author</em> columns, and remove any word with less than 3 characters. Assign to <code>all_words</code></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">all_words &lt;-<span class="st"> </span>exploded <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(word, author) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">nchar</span>(word) <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div></li>
<li><p>Cache the <code>all_words</code> variable using <code>compute()</code></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">all_words &lt;-<span class="st"> </span>all_words <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="st">  </span><span class="kw">compute</span>(<span class="st">&quot;all_words&quot;</span>)</a></code></pre></div></li>
</ol>
</div>
<div id="data-exploration" class="section level2">
<h2><span class="header-section-number">2.4</span> Data Exploration</h2>
<p><em>Used word clouds to explore the data</em></p>
<ol style="list-style-type: decimal">
<li><p>Create a variable with the word count by author, name it <code>word_count</code></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">word_count &lt;-<span class="st"> </span>all_words <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(author, word, <span class="dt">sort =</span> <span class="ot">TRUE</span>) </a></code></pre></div></li>
<li><p>Filter <code>word_cout</code> to only retain “twain”, assign it to <code>twain_most</code></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">twain_most &lt;-<span class="st"> </span>word_count <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(author <span class="op">==</span><span class="st"> &quot;twain&quot;</span>)</a></code></pre></div></li>
<li><p>Use <code>wordcloud</code> to visualize the top 50 words used by Twain</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">twain_most <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="st">  </span><span class="kw">with</span>(wordcloud<span class="op">::</span><span class="kw">wordcloud</span>(</a>
<a class="sourceLine" id="cb37-5" data-line-number="5">    word, </a>
<a class="sourceLine" id="cb37-6" data-line-number="6">    n,</a>
<a class="sourceLine" id="cb37-7" data-line-number="7">    <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>,<span class="st">&quot;#56B4E9&quot;</span>))</a>
<a class="sourceLine" id="cb37-8" data-line-number="8">    )</a></code></pre></div></li>
<li><p>Filter <code>word_cout</code> to only retain “doyle”, assign it to <code>doyle_most</code></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">doyle_most &lt;-<span class="st"> </span>word_count <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(author <span class="op">==</span><span class="st"> &quot;doyle&quot;</span>)</a></code></pre></div></li>
<li><p>Used <code>wordcloud</code> to visualize the top 50 words used by Doyle that have more than 5 characters</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">doyle_most <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">nchar</span>(word) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-4" data-line-number="4"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="st">  </span><span class="kw">with</span>(wordcloud<span class="op">::</span><span class="kw">wordcloud</span>(</a>
<a class="sourceLine" id="cb39-6" data-line-number="6">word, </a>
<a class="sourceLine" id="cb39-7" data-line-number="7">n,</a>
<a class="sourceLine" id="cb39-8" data-line-number="8"><span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>,<span class="st">&quot;#56B4E9&quot;</span>)</a>
<a class="sourceLine" id="cb39-9" data-line-number="9">))</a></code></pre></div></li>
<li><p>Use <code>anti_join()</code> to figure out which words are used by Doyle but not Twain. Order the results by number of words.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">doyle_unique &lt;-<span class="st"> </span>doyle_most <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="st">  </span><span class="kw">anti_join</span>(twain_most, <span class="dt">by =</span> <span class="st">&quot;word&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) </a></code></pre></div></li>
<li><p>Use <code>wordcloud</code> to visualize top 50 records in the previous step</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">doyle_unique <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="st">  </span><span class="kw">collect</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="st">  </span><span class="kw">with</span>(wordcloud<span class="op">::</span><span class="kw">wordcloud</span>(</a>
<a class="sourceLine" id="cb41-5" data-line-number="5">    word, </a>
<a class="sourceLine" id="cb41-6" data-line-number="6">    n,</a>
<a class="sourceLine" id="cb41-7" data-line-number="7">    <span class="dt">colors =</span> <span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>,<span class="st">&quot;#56B4E9&quot;</span>))</a>
<a class="sourceLine" id="cb41-8" data-line-number="8">    )</a></code></pre></div></li>
<li><p>Find out how many times Twain used the word “sherlock”</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">all_words <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(author <span class="op">==</span><span class="st"> &quot;twain&quot;</span>, word <span class="op">==</span><span class="st"> &quot;sherlock&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="st">  </span><span class="kw">tally</span>()</a></code></pre></div></li>
<li><p>Against the <code>twain</code> variable, use Hive’s <em>instr</em> and <em>lower</em> to make all ever word lower cap, and then look for “sherlock” in the line</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">twain <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">line =</span> <span class="kw">lower</span>(line)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">instr</span>(line, <span class="st">&quot;sherlock&quot;</span>) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-4" data-line-number="4"><span class="st">  </span><span class="kw">pull</span>(line)</a></code></pre></div></li>
<li><p>Close Spark session</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">spark_disconnect</span>(sc)</a></code></pre></div></li>
</ol>
<p>Most of these lines are in a short story by Mark Twain called <a href="https://www.gutenberg.org/files/3180/3180-h/3180-h.htm#link2H_4_0008">A Double Barrelled Detective Story</a>. As per the <a href="https://en.wikipedia.org/wiki/A_Double_Barrelled_Detective_Story">Wikipedia</a> page about this story, this is a satire by Twain on the mystery novel genre, published in 1902.</p>
</div>
<div id="appendix" class="section level2">
<h2><span class="header-section-number">2.5</span> Appendix</h2>
<p>How to download books</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">library</span>(gutenbergr)</a>
<a class="sourceLine" id="cb45-2" data-line-number="2"></a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="kw">gutenberg_works</span>()  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(author <span class="op">==</span><span class="st"> &quot;Twain, Mark&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-5" data-line-number="5"><span class="st">  </span><span class="kw">pull</span>(gutenberg_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-6" data-line-number="6"><span class="st">  </span><span class="kw">gutenberg_download</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-7" data-line-number="7"><span class="st">  </span><span class="kw">pull</span>(text) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-8" data-line-number="8"><span class="st">  </span><span class="kw">writeLines</span>(<span class="st">&quot;mark_twain.txt&quot;</span>)</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="databricks-connect.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="intro-to-sparklyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
